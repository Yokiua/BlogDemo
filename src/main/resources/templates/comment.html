<!DOCTYPE HTML>
<html class="no-js" lang="en" xmlns:v-bind="http://www.w3.org/1999/xhtml">
<head>
	<meta charset="utf-8">
	<meta http-equiv="x-ua-compatible" content="ie=edge">
	<meta name="author" content="smartit-source">
	<meta name="description" content="">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<!-- title here -->
	<title>留言板</title>
	<script src="../static/js/jquery-3.5.1.min.js"></script>
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/semantic-ui/2.2.4/semantic.min.css">
	<!--下面是插件-->
	<!--引入animate动画的css-->
	<link rel="stylesheet" href="../static/css/animate.css">
	<!--引入排版插件的css-->
	<link rel="stylesheet" href="../static/css/typo.css">
	<!--引入animate动画的css-->
	<link rel="stylesheet" href="../static/css/animate.css">
	<!--prism(代码高亮)插件-->
	<link rel="stylesheet" href="../static/lib/prism/prism.css">
	<script src="../static/lib/prism/prism.js"></script>
	<!-- Favicon and Touch Icons -->
	<link rel="shortcut icon" href="../static/assets/images/fav.png">
	<!-- Place favicon.ico in the root directory -->
	<link rel="apple-touch-icon" href="apple-touch-icon.png">
	<!-- Fonts -->
	<link href="https://fonts.googleapis.com/css?family=Poppins:300,400,500,600,700,800,900" rel="stylesheet">
	<link rel="stylesheet" href="../static/assets/css/font-awesome.min.css">
	<link rel="stylesheet" href="../static/assets/css/flaticon.css">
	<!-- Plugin CSS -->
	<link rel="stylesheet" href="../static/assets/css/bootstrap.min.css">
	<link rel="stylesheet" href="../static/assets/css/animate.css">
	<link rel="stylesheet" href="../static/assets/css/magnific-popup.css">
	<link rel="stylesheet" href="../static/assets/css/owl.carousel.css">
	<link rel="stylesheet" href="../static/assets/css/owl.theme.css">
	<link rel="stylesheet" href="../static/assets/css/owl.transitions.css">
	<link rel="stylesheet" href="../static/assets/css/jquery.barfiller.css">
	<!--Theme custom css -->
	<link rel="stylesheet" href="../static/assets/css/style.css">
	<!--Theme Responsive css-->
	<link rel="stylesheet" href="../static/assets/css/responsive.css" />
	<script src="../static/assets/js/vendor/modernizr-2.8.3-respond-1.4.2.min.js"></script>
	</head>
<body>
	<!-- 页眉区域从这里开始 -->
	<header class="header-area" id="sticky">
		<div class="container">
			<div class="row">
				<div class="col-md-2 col-xs-6">
					<div class="log-area">
						<a href="/"><img src="../static/assets/images/logo.png" style="margin-top: 7px !important;" alt=""></a>
					</div>
				</div>
				<div class="col-md-9">
					<div class="menu-area white">
						<nav>
							<ul>
								<li class="sub"><a href="/">首页 <span class="fa fa-angle-down"></span></a>
									<ul class="sub-menu">
										<li><a href="/MyBlog/types">分类</a></li>
										<li><a href="/MyBlog/tags">标签</a></li>
										<li><a href="/MyBlog/archives">归档</a></li>
										<li class="active"><a href="/MyBlog/comment">留言板</a></li>
										<li><a href="/MyBlog/about">关于我</a></li>
									</ul>
								</li>
								<li><a href="/MyBlog/types">分类</a></li>
								<li><a href="/MyBlog/tags">标签</a></li>
								<li><a href="/MyBlog/archives">归档</a></li>
								<li class="active"><a href="/MyBlog/comment">留言板</a></li>
								<li><a href="/MyBlog/about">关于我</a></li>
								<!--搜索框-->
								<li>
									<div class="right m-item item">
										<form name="search" action="/search" method="get" data-pjax class="myForm"  target="_blank">
											<div class="ui icon inverted input">
												<input type="text" name="query" placeholder="Search...." class="queryText" style="opacity: 0.7 !important;">
												<i class="query search link icon" onclick="formClick()"></i>
											</div>
										</form>
									</div>
								</li>
							</ul>
						</nav>
					</div>
				</div>
				<div class="col-md-1 col-xs-6">
					<div class="humbargar-area">
						<!---->
						<div class="menu-icon text-right">
							<span class="flaticon-menu humbargar color"></span>
						</div>
						<div class="close-area">
							<span class="close"></span>
						</div>
					</div>
				</div>
			</div>
		</div>
	</header>
	<!-- 菜单区从这里开始 -->
	<div class="sidebar-menu ">
		<div class="close-area">
			<span class="close"><i class="icon fa fa-times-circle"></i></span>
		</div>
		<div class="main-menu">
			<nav>
				<ul>
					<li><a href="/">首页</a></li>
					<li><a href="/MyBlog/types">分类</a></li>
					<li><a href="/MyBlog/tags">标签</a></li>
					<li><a href="/MyBlog/archives">归档</a></li>
					<li class="active"><a href="blog.html">留言区</a></li>
					<li><a href="/MyBlog/about">关于我</a></li>
					<li>
						<div class="right m-item item">
							<form name="search" action="/search" method="get" data-pjax class="myForm" target="_blank">
								<div class="ui icon inverted  input m-margin-tb-tiny">
									<input type="text" name="query" placeholder="Search...." class="queryText">
									<i class="query search link icon" onclick="formClick()"></i>
								</div>
							</form>
						</div>
					</li>
				</ul>
			</nav>
		</div>
	</div>
	<!-- 大图区域从这里开始	 -->
	<div class="breadcrumb-area" id="header" style="background-image: url('../static/imges/comment_bg.jpg');height: 30%">
		<div class="container">
			<div class="row">
				<div class="col-sm-12">
					<div class="breadcrumb-title">
						<h2>留言区</h2>
					</div>
				</div>
			</div>
		</div>
	</div>

	<div class="blog-details-area section animate__animated animate__pulse" id="comment">
			<div class="container">
				<div class="row">
					<div class="col-lg-8 col-md-offset-2">
						<!--评论区-->
						<div class="comment-area box-shadow mt-110"  id="liuyan">
							<div class="section-title">
								<h3>留言</h3>
							</div>
							<!-- 留言 -->
							<div class="comment-list" v-for="comment in comments.list">
								<!--父评论-->
								<div class="single-comment">
									<div class="member-image" >
										<a><img src="../static/imges/avatar.jpg" alt="comment img"></a>
									</div>
									<div class="comment-info">
										<div class="comment-title">
											<h4><a href="" @click.prevent="NickName(comment.nickname,comment.id)" v-text="comment.nickname"></a>
												<a v-if="comment.flag==true" class="ui basic teal left pointing label m-padded-mini-02 m-text-thin">管理员&nbsp;</a>
												<span v-text="comment.create_time"></span></h4>
										</div>
										<div class="comment-content">
											<p v-text="comment.content"></p>
										</div>
										<div class="comment-replay">
											<a href="" class="replay-btn" @click.prevent="NickName(comment.nickname,comment.id)">回复</a>
											<a href="" class="replay-btn" v-if="admin == true" @click.prevent="removeComment(comment.id,comment.parent_comment_id)">删除</a>
										</div>
									</div>
								</div>
								<!--子评论-->
								<div v-if="comment.parentCommentS.length != 0">
									<div class="single-comment pl-100" v-for="parent in comment.parentCommentS">
										<div class="member-image">
											<a href="#" @click.prevent="NickName(parent.nickname,parent.parent_comment_id)"><img src="../static/imges/avatar.jpg" alt="comment img"></a>
										</div>
										<div class="comment-info">
											<div class="comment-title">
												<h4><a href="#" v-text="parent.nickname"></a>
													<a v-if="parent.flag==true" class="ui basic teal left pointing label m-padded-mini-02 m-text-thin">管理员&nbsp;</a>
													<span class="m-text-thin" style="color:#0a628f;" v-text="parent.replyToUser"></span>
													<span v-text="parent.create_time"></span></h4>
											</div>
											<div class="comment-content">
												<p v-text="parent.content"></p>
											</div>
											<div class="comment-replay">
												<a href="#" class="replay-btn" @click.prevent="NickName(parent.nickname,parent.parent_comment_id)">回复</a>
												<a href="#" class="replay-btn" v-if="admin == true" @click.prevent="removeComment(parent.id,parent.parent_comment_id)">删除</a>
											</div>
										</div>
									</div>
								</div>
							</div>
							<!-- 提交留言表单 -->
							<div class="comment-from mt-63">
								<div class="section-title">
									<h3>留言</h3>
								</div>

								<form action="" class="ui form" id="commentFrom" @submit.prevent="saveCommentForm">
									<!--提交回复的评论id(隐含域)-->
									<input type="hidden" name="parent_comment_id" v-bind:value="parent_comment_id">
									<!--提交回复的用户名-->
									<input type="hidden" name="ReplyToUser" v-bind:value="ReplyToUser">
									<!--评论的是否是博主-->
									<input type="hidden" name="flag" v-bind:value="[admin==true ? true : false]">
									<div class="row">
										<!--昵称-->
										<div class="col-lg-6">
											<div class="form-group box-shadow">
												<input type="text" placeholder="昵称" name="nickname" id="commentNickname" v-if="admin==false">
												<input type="text" v-bind:placeholder="adminUser.nickname" name="nickname" v-if="admin==true" v-bind:value="adminUser.nickname" readonly ="readonly">
											</div>
										</div>
										<div class="col-lg-6">
											<div class="form-group box-shadow">
												<input type="email" placeholder="邮箱" name="email" id="commentEmail" v-if="admin==false">
												<input type="email" placeholder="管理员邮箱" name="email" readonly ="readonly" v-if="admin==true" v-bind:value="adminUser.email">
											</div>
										</div>
										<div class="col-lg-12">
											<div class="form-group box-shadow">
												<textarea name="content" v-bind:placeholder="commentNickname" id="commentContent"></textarea>
											</div>
										</div>
										<div class="col-lg-12">
											<div class="from-btn">
												<button type="submit" class="primary-btn">发送</button>
											</div>
										</div>
									</div>
								</form>
							</div>
						</div>
					</div>
				</div>
			</div>

			<!-- leaf left area start here	 -->
			<div class="leaf-left">
				<img src="../static/assets/images/leaf-left.png" alt="leaf-right">
			</div>
			<!-- leaf left area end here	 -->
			<!-- leaf right area start here	 -->
			<div class="leaf-right">
				<img src="../static/assets/images/leaf-right.png" alt="leaf-right">
			</div>
			<!-- leaf right area end here	 -->
		</div>
	<!-- 页脚区域从这里开始 -->
	<footer class="footer-area" id="footer">
		<div class="footer-top">
			<div class="container">
				<div class="row">
					<div class="col-md-6">
						<div class="footer-widget widget-text">
							<div class="footer-logo">
								<h2><a href="#">Yokiua </a></h2>
							</div>
							<div class="widget-content">
								<p>乘上与平时相反的列车，为了去见从未见过的风景。 当你无法回头的时候，才是真正的旅途。 人性中是有恶意的，不要以恶意去应对恶意，昂首挺胸吧。 </p>
							</div>
						</div>
					</div>
					<!--展示最新的文章-->
					<div class="col-md-3">
						<div class="footer-widget widget-recent-post">
							<div class="widget-title">
								<h3>Recent Post</h3>
							</div>
							<div class="recent-post-list">
								<!--列表-->
								<div class="single-post" v-for="blog in newBlog.list">
									<p><a v-bind:href="['/MyBlog/blog?id='+blog.id]">{{blog.title}}</a></p>
								</div>
							</div>
						</div>
					</div>
					<div class="col-md-3">
						<div class="footer-widget widget-Subscribe">
							<div class="widget-title">
								<h3>Contact Me</h3>
							</div>
							<div >
								<img src="../static/imges/wechat.jpg" alt="wechat">
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		<div class="footer-bottom">
			<div class="container">
				<div class="row">
					<div class="col-md-6">
						<div class="copyright-area">
							<p>&copy; 2020 Yokiua . All rights Reserved.</p>
						</div>
					</div>
					<div class="col-md-6">
						<div class="footer-right text-right">
							<p>By <a href="/MyBlog/about" title="bootstrapmb">Jia</a></p>
						</div>
					</div>
				</div>
			</div>
		</div>
	</footer>
	<script src="../static/assets/js/vendor/jquery-1.12.0.min.js"></script>
	<script src="../static/assets/js/plugins.js"></script>
	<script src="../static/assets/js/Popper.js"></script>
	<script src="../static/assets/js/bootstrap.min.js"></script>
	<script src="../static/assets/js/jquery.magnific-popup.min.js"></script>
	<script src="../static/assets/js/owl.carousel.min.js"></script>
	<script src="../static/assets/js/isotope.pkgd.min.js"></script>
	<script src="../static/assets/js/imagesloaded.pkgd.min.js"></script>
	<script src="../static/assets/js/scrollup.js"></script>
	<script src="../static/assets/js/jquery.counterup.min.js"></script>
	<script src="../static/assets/js/waypoints.min.js"></script>
	<script src="../static/assets/js/jquery.appear.js"></script>
	<script src="../static/assets/js/jquery.barfiller.js"></script>
	<script src="../static/assets/js/main.js"></script>
	<script src="https://cdn.jsdelivr.net/semantic-ui/2.2.4/semantic.min.js"></script>
	<!--平滑滚动插件-->
	<script src="../static/lib/scrollTo/jquery.scrollTo.min.js"></script>
	<!-- vue -->
	<script src="https://cdn.jsdelivr.net/npm/vue"></script>
	<!--live2D-->
	<script src="https://cdn.jsdelivr.net/gh/yremp/live2d@1.0/autoload.js"></script>
	<!--搜索框校验 -->
	<script>
		/*表单校验*/
		$('.myForm').form({
			fields: {
				query: {
					identifier: 'query',
					rules: [{
						type: 'empty',
					}]
				}
			}
		});
		function formClick(){
			var query = $(".queryText").val();
			if (query != ""){
				document.forms['search'].submit()
			}else {
				alert("请输入搜索内容")
			}
		}
	</script>
	<!--vue代码-->
	<script>
		/* --------------------------Vue-----------------------------*/
		var vue = new Vue({
			el:"#comment",
			data:{
				comments:"",
				commentNickname:"请输入评论信息...",
				ReplyToUser:null, //回复的用户名
				parent_comment_id:null,

				admin:false,
				adminUser:"",
				sortDateBlog:""
			},
			methods:{
				getComment:function () { //获取评论
					var thar = this;
					$.get("comment/findComment",{},function (comments) {
						thar.comments = comments;
					},"json");
				},
				NickName:function (nickname,parent_comment_id) { //点击回复功能
					this.commentNickname = "@" + nickname;
					this.ReplyToUser = "@" + nickname;
					this.parent_comment_id = parent_comment_id;
					//点击回复时，屏幕滚动到留言区域
					$(window).scrollTo($("#commentFrom"),500);
				},
				saveCommentForm:function () { //留言提交
					var content = $("#commentContent").val();
					var nickname = $("#commentNickname").val();
					var email = $("#commentEmail").val();
					var thar = this;
					if (content == "" || nickname == "" || email == ""){
						alert("请输入内容&昵称&邮箱")
					}else {
						$.ajaxSettings.async = false;
						$.post("comment/saveComment",$("#commentFrom").serialize(),function (flag) {
							if (flag){
								//发表成功,调用ajax局部刷新
								thar.getComment();
								//提交完毕之后,把参数初始化
								this.parent_comment_id = null;
								this.ReplyToUser = null;
								this.commentNickname = "请输入评论信息...";
								$("#commentContent").val("");
								/*滚动到留言位置*/
								$(window).scrollTo($("#liuyan"),500);
							}else {
								alert("发表失败,请重试")
							}
						});
						$.ajaxSettings.async = true;
					}
					return false;
				},
				checkAdmin:function () { //校验是否管理员登录了
					var thar = this;
					$.ajaxSettings.async = false;
					$.post("comment/checkAdmin",{},function (flag) {
						if (flag.length !== 0 && flag !== "{}" && flag !== ""){
							//说明管理员登录了
							thar.admin = true;
							thar.adminUser = flag;
						}
					},"json");
					$.ajaxSettings.async = true;
				},
				removeComment:function (commentId,parent_comment_id) { //删除留言
					if (confirm("要删除吗")){
						var thar = this;
						$.get("comment/removeComment",{id:commentId,parent_comment_id:parent_comment_id},function (flag) {
							if (flag){
								thar.getComment()
							}else {
								alert("删除失败,请重试")
							}
						});
					}
				}
			}
		});
		newBlog = new Vue({
			el:"#footer",
			data:{
				newBlog:""
			},
			methods:{
				getNewBlog:function () {
					var thar = this;
					$.get("index/sortDateBlog",{pageSize:3},function (SortDateBlog) {
						thar.newBlog = SortDateBlog;
					},"json");
				}
			}
		})
		newBlog.getNewBlog();
		vue.checkAdmin();
		vue.getComment();
	</script>
</body>
</html>
